define(function(require,exports,module){var c=require("./gmu");var b=c.$;var a={close:'<a class="ui-dialog-close" title="关闭"><span class="ui-icon ui-icon-delete"></span></a>',mask:'<div class="ui-mask"></div>',title:'<div class="ui-dialog-title"><h3><%=title%></h3></div>',wrap:'<div class="ui-dialog"><div class="ui-dialog-content"></div><% if(btns){ %><div class="ui-dialog-btns"><% for(var i=0, length=btns.length; i<length; i++){var item = btns[i]; %><a class="ui-btn ui-btn-<%=item.index%>" data-key="<%=item.key%>"><%=item.text%></a><% } %></div><% } %></div> '};
c.define("Dialog",{options:{autoOpen:true,buttons:null,closeBtn:true,mask:true,width:300,height:"auto",title:null,content:null,scrollMove:true,container:null,maskClick:null,position:null},getWrap:function(){return this._options._wrap;
},_init:function(){var h=this,g=h._options,f,e=0,d=b.proxy(h._eventHandler,h),j={};h.on("ready",function(){g._container=b(g.container||document.body);(g._cIsBody=g._container.is("body"))||g._container.addClass("ui-dialog-container");
j.btns=f=[];g.buttons&&b.each(g.buttons,function(i){f.push({index:++e,text:i,key:i});});g._mask=g.mask?b(a.mask).appendTo(g._container):null;g._wrap=b(b.parseTpl(a.wrap,j)).appendTo(g._container);
g._content=b(".ui-dialog-content",g._wrap);g._title=b(a.title);g._close=g.closeBtn&&b(a.close).highlight("ui-dialog-close-hover");h.$el=h.$el||g._content;
h.title(g.title);h.content(g.content);f.length&&b(".ui-dialog-btns .ui-btn",g._wrap).highlight("ui-state-hover");g._wrap.css({width:g.width,height:g.height});
b(window).on("ortchange",d);g._wrap.on("click",d);g._mask&&g._mask.on("click",d);g.autoOpen&&h.open();});},_create:function(){var d=this._options;if(this._options.setup){d.content=d.content||this.$el.show();
d.title=d.title||this.$el.attr("title");}},_eventHandler:function(j){var i=this,d,g,h=i._options,f;switch(j.type){case"ortchange":this.refresh();break;
case"touchmove":h.scrollMove&&j.preventDefault();break;case"click":if(h._mask&&(b.contains(h._mask[0],j.target)||h._mask[0]===j.target)){return i.trigger("maskClick");
}g=h._wrap.get(0);if((d=b(j.target).closest(".ui-dialog-close",g))&&d.length){i.close();}else{if((d=b(j.target).closest(".ui-dialog-btns .ui-btn",g))&&d.length){f=h.buttons[d.attr("data-key")];
f&&f.apply(i,arguments);}}}},_calculate:function(){var j=this,i=j._options,h,k,e=document.body,g={},d=i._cIsBody,f=Math.round;i.mask&&(g.mask=d?{width:"100%",height:Math.max(e.scrollHeight,e.clientHeight)-1}:{width:"100%",height:"100%"});
h=i._wrap.offset();k=b(window);g.wrap={left:"50%",marginLeft:-f(h.width/2)+"px",top:d?f(k.height()/2)+window.pageYOffset:"50%",marginTop:-f(h.height/2)+"px"};
return g;},refresh:function(){var f=this,e=f._options,d,g;if(e._isOpen){g=function(){d=f._calculate();d.mask&&e._mask.css(d.mask);e._wrap.css(d.wrap);};
if(b.os.ios&&document.activeElement&&/input|textarea|select/i.test(document.activeElement.tagName)){document.body.scrollLeft=0;b.later(g,200);}else{g();
}}return f;},open:function(d,f){var e=this._options;e._isOpen=true;e._wrap.css("display","block");e._mask&&e._mask.css("display","block");d!==undefined&&this.position?this.position(d,f):this.refresh();
b(document).on("touchmove",b.proxy(this._eventHandler,this));return this.trigger("open");},close:function(){var e,d=this._options;e=b.Event("beforeClose");
this.trigger(e);if(e.defaultPrevented){return this;}d._isOpen=false;d._wrap.css("display","none");d._mask&&d._mask.css("display","none");b(document).off("touchmove",this._eventHandler);
return this.trigger("close");},title:function(e){var d=this._options,f=e!==undefined;if(f){e=(d.title=e)?"<h3>"+e+"</h3>":e;d._title.html(e)[e?"prependTo":"remove"](d._wrap);
d._close&&d._close.prependTo(d.title?d._title:d._wrap);}return f?this:d.title;},content:function(e){var d=this._options,f=e!==undefined;f&&d._content.empty().append(d.content=e);
return f?this:d.content;},destroy:function(){var d=this._options,e=this._eventHandler;b(window).off("ortchange",e);b(document).off("touchmove",e);d._wrap.off("click",e).remove();
d._mask&&d._mask.off("click",e).remove();d._close&&d._close.highlight();return this.$super("destroy");}});});