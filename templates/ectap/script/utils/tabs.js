define(function(require,exports,module){var e=require("./gmu");var d=e.$;var b=1,a=function(){return b++;},c=/^#(.+)$/;e.define("Tabs",{options:{active:0,items:null,transition:"slide"},template:{nav:'<ul class="ui-tabs-nav"><% var item; for(var i=0, length=items.length; i<length; i++) { item=items[i]; %><li<% if(i==active){ %> class="ui-state-active"<% } %>><a href="javascript:;"><%=item.title%></a></li><% } %></ul>',content:'<div class="ui-viewport ui-tabs-content"><% var item; for(var i=0, length=items.length; i<length; i++) { item=items[i]; %><div<% if(item.id){ %> id="<%=item.id%>"<% } %> class="ui-tabs-panel <%=transition%><% if(i==active){ %> ui-state-active<% } %>"><%=item.content%></div><% } %></div>'},_init:function(){var i=this,h=i._options,g,f=d.proxy(i._eventHandler,i);
i.on("ready",function(){g=i.$el;g.addClass("ui-tabs");h._nav.on("tap",f).children().highlight("ui-state-hover");});d(window).on("ortchange",f);},_create:function(){var g=this,f=g._options;
if(g._options.setup&&g.$el.children().length>0){g._prepareDom("setup",f);}else{f.setup=false;g.$el=g.$el||d("<div></div>");g._prepareDom("create",f);}},_prepareDom:function(i,m){var l=this,j,n=l.$el,k,f,h,g;
switch(i){case"setup":m._nav=l._findElement("ul").first();if(m._nav){m._content=l._findElement("div.ui-tabs-content");m._content=((m._content&&m._content.first())||d("<div></div>").appendTo(n)).addClass("ui-viewport ui-tabs-content");
k=[];m._nav.addClass("ui-tabs-nav").children().each(function(){var q=l._findElement("a",this),o=q?q.attr("href"):d(this).attr("data-url"),r,p;r=c.test(o)?RegExp.$1:"tabs_"+a();
(p=l._findElement("#"+r)||d('<div id="'+r+'"></div>')).addClass("ui-tabs-panel"+(m.transition?" "+m.transition:"")).appendTo(m._content);k.push({id:r,href:o,title:q?q.attr("href","javascript:;").text():d(this).text(),content:p});
});m.items=k;m.active=Math.max(0,Math.min(k.length-1,m.active||d(".ui-state-active",m._nav).index()||0));l._getPanel().add(m._nav.children().eq(m.active)).addClass("ui-state-active");
break;}default:k=m.items=m.items||[];f=[];h=[];m.active=Math.max(0,Math.min(k.length-1,m.active));d.each(k,function(o,p){g="tabs_"+a();f.push({href:p.href||"#"+g,title:p.title});
h.push({content:p.content||"",id:g});k[o].id=g;});m._nav=d(this.tpl2html("nav",{items:f,active:m.active})).prependTo(n);m._content=d(this.tpl2html("content",{items:h,active:m.active,transition:m.transition})).appendTo(n);
m.container=m.container||(n.parent().length?null:"body");}m.container&&n.appendTo(m.container);l._fitToContent(l._getPanel());},_getPanel:function(f){var g=this._options;
return d("#"+g.items[f===undefined?g.active:f].id);},_findElement:function(f,h){var g=d(h||this.$el).find(f);return g.length?g:null;},_eventHandler:function(h){var f,g=this._options;
switch(h.type){case"ortchange":this.refresh();break;default:if((f=d(h.target).closest("li",g._nav.get(0)))&&f.length){h.preventDefault();this.switchTo(f.index());
}}},_fitToContent:function(h){var g=this._options,f=g._content;g._plus===undefined&&(g._plus=parseFloat(f.css("border-top-width"))+parseFloat(f.css("border-bottom-width")));
f.height(h.height()+g._plus);return this;},switchTo:function(f){var i=this,j=i._options,h=j.items,m,k,l,g,n;if(!j._buzy&&j.active!=(f=Math.max(0,Math.min(h.length-1,f)))){k=d.extend({},h[f]);
k.div=i._getPanel(f);k.index=f;l=d.extend({},h[j.active]);l.div=i._getPanel();l.index=j.active;m=e.Event("beforeActivate");i.trigger(m,k,l);if(m.isDefaultPrevented()){return i;
}j._content.children().removeClass("ui-state-active");k.div.addClass("ui-state-active");j._nav.children().removeClass("ui-state-active").eq(k.index).addClass("ui-state-active");
if(j.transition){j._buzy=true;n=d.fx.animationEnd+".tabs";g=f>j.active?"":" reverse";j._content.addClass("ui-viewport-transitioning");l.div.addClass("out"+g);
k.div.addClass("in"+g).on(n,function(o){if(o.target!=o.currentTarget){return;}k.div.off(n,arguments.callee);j._buzy=false;l.div.removeClass("out reverse");
k.div.removeClass("in reverse");j._content.removeClass("ui-viewport-transitioning");i.trigger("animateComplete",k,l);i._fitToContent(k.div);});}j.active=f;
i.trigger("activate",k,l);j.transition||i._fitToContent(k.div);}return i;},refresh:function(){return this._fitToContent(this._getPanel());},destroy:function(){var g=this._options,f=this._eventHandler;
g._nav.off("tap",f).children().highlight();g.swipe&&g._content.off("swipeLeft swipeRight",f);if(!g.setup){this.$el.remove();}return this.$super("destroy");
}});});